
==================
pcapalign
==================

About
-----

This is a GPLv3 (see ``LICENSE`` file) program that calculates temporal skew between two pcap(NG) capture files using traffic correlation based on inter-packet timing. It's more or less a research prototype.


Prerequisites
-------------

- `Numpy <http://numpy.scipy.org/>`_ (1.8.0)
- `pylibpcap <https://pypi.python.org/pypi/pylibpcap/0.6.3>`_ (0.6.3)
- `PrettyTable <https://pypi.python.org/pypi/PrettyTable/0.7.2>`_ (0.7.2)



Author
-------

Wicher Minnaard <wicher@nontrivialpursuit.org>

Bugs
----

Not really a bug in this program: the pylibpcap interface to libpcap doesn't close files when the ``pcapObject`` is garbage collected.
Hence you'll find yourself running out of file descriptors when you have opened hundreds of pcap files over the lifetime of a single cpython instance.
Since this program creates a ``pcapObject`` for every traffic class, you may run into resource issues.

Workaround: up your file descriptor limit (``su -c "ulimit -n unlimited; su `whoami`"``) or, using the ``--limit`` argument, limit the amount of filters to generate.

Usage
-----

Here's how to run it::


        usage: pcapalign.py [-h] [-r NUMBER] [-l NUMBER] [-s SECONDS] [-m NUMBER] [-q]
                    [--slomo] [-b NUMBER] [-f FILTER]
                    PCAP_A PCAP_B


        Calculates time skew of pcap(ng) file B relative to pcap(ng) file A using
        traffic correlation. A and B should have some traffic in common. NAT spoils
        the fun. Supports IPv6.

        positional arguments:
          PCAP_A
          PCAP_B

        optional arguments:
          -h, --help            show this help message and exit
          -f FILTER, --pcapfilter FILTER
                                Use pcap filter expression FILTER to limit examined
                                traffic ('man 7 pcap-filter').

        Algorithm parameters:
          -r NUMBER, --round NUMBER
                                Round fractions of seconds in packet timestamps to
                                NUMBER of decimals. 3 (round to nearest millisecond)
                                is the default, it is usually a good choice for
                                situations with sub-millisecond jitter between capture
                                point A and B.
          -l NUMBER, --limit NUMBER
                                Use max NUMBER of autogenerated filters (default 500).
          -s SECONDS, --span SECONDS
                                Disregard streaks which span < SECONDS (default 0.01).
          -m NUMBER, --minmatch NUMBER
                                Only consider classes which match more than NUMBER
                                packets in both A and B. Default 5.

        Display parameters:
          -q, --quiet           Suppress table output.
          --slomo               Wait for one jiffie between skew table display
                                updates.
          -b NUMBER, --bucketround NUMBER
                                Size of skew buckets, 10**-NUMBER. Default 1 for 0.1s
                                buckets.

